<!doctype html>
<script src="/assets/js/custom/sidebar-toggle.js"></script>
<html lang="en" >
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
 <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
 <meta name="mobile-web-app-capable" content="yes">
 <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
 <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus" />
<meta property="og:locale" content="en" />
<meta name="description" content="Exploring how I built a Prometheus exporter to track live attendance at my local gym. From data scraping to trend analysis, here’s how I turned raw numbers into actionable insights." />
<meta property="og:description" content="Exploring how I built a Prometheus exporter to track live attendance at my local gym. From data scraping to trend analysis, here’s how I turned raw numbers into actionable insights." />
<link rel="canonical" href="https://travispooley.com/blog/gym/" />
<meta property="og:url" content="https://travispooley.com/blog/gym/" />
<meta property="og:site_name" content="Travis Pooley" />
<meta property="og:image" content="https://travispooley.com/assets/images/gym/gym_dashboard_darkmode.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-04T12:00:00+09:30" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://travispooley.com/assets/images/gym/gym_dashboard_darkmode.webp" />
<meta property="twitter:title" content="Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus" />
<meta name="twitter:site" content="@travispooley" />
<meta name="google-site-verification" content="f02O3VZopgRRCh11WVAYFg7u8JqoCK5JUkV8v7RVTVs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-04T12:00:00+09:30","datePublished":"2025-04-04T12:00:00+09:30","description":"Exploring how I built a Prometheus exporter to track live attendance at my local gym. From data scraping to trend analysis, here’s how I turned raw numbers into actionable insights.","headline":"Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus","image":"https://travispooley.com/assets/images/gym/gym_dashboard_darkmode.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://travispooley.com/blog/gym/"},"url":"https://travispooley.com/blog/gym/"}</script>
 <title>Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus | Travis Pooley
 </title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Travis Pooley">
<meta name="application-name" content="Travis Pooley">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  <script src="/assets/js/dist/theme.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>
<script defer src="/assets/js/dist/post.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZJGB7Q1Y9"></script>
<script>
  /* global dataLayer */
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-3ZJGB7Q1Y9');
</script>
 <body>
<div class="nx-topbar-wrapper" id="topbar">
 <div class="nx-topbar">
   <div class="nx-container">
     <div class="nx-logo">
        <a href="/">Travis Pooley</a>
     </div>
     <nav class="nx-nav">
       <ul>
         <li><a href="/">Home</a>
         <li><a href="/#about">About</a>
         <li><a href="/#experience">Experience</a>
         <li><a href="/books">Books</a>
         <li><a href="/blog">Blog</a>
       </ul>
     </nav>
     <div class="nx-actions">
        <button id="topbar-theme-toggle" class="theme-toggle" aria-label="Toggle Dark Mode">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sun-icon">
            <circle cx="12" cy="12" r="5"></circle>
           <line x1="12" y1="1" x2="12" y2="3"></line>
           <line x1="12" y1="21" x2="12" y2="23"></line>
           <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
           <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
           <line x1="1" y1="12" x2="3" y2="12"></line>
           <line x1="21" y1="12" x2="23" y2="12"></line>
           <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
           <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="moon-icon">
           <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
        <a href="/#contact" class="nx-button primary">Contact</a>
     </div>
   </div>
 </div>
</div>
<style>
/* CSS for the top menu bar with dark/light mode support */
:root {
  --nx-primary: #0066FF;
}
.nx-topbar-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 10px 0;
}
.nx-topbar {
  width: 100%;
  max-width: 1250px;
  padding: 10px 24px;
  position: sticky;
  top: 0;
  z-index: 1000;
}
/* Light mode styles (default) */
.nx-topbar {
  background: var(--main-bg);
}
.nx-logo a {
  color: var(--heading-color);
}
.nx-nav a {
  color: var(--heading-color);
}
.theme-toggle {
  color: var(--heading-color);
}
.nx-container {
  width: 100%;
  padding: 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.nx-logo a {
  font-size: 24px;
  font-weight: bold;
  text-decoration: none;
}
.nx-nav ul {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}
.nx-nav li {
  margin: 0 15px;
  position: relative;
}
.nx-nav a {
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: color 0.2s;
}
.nx-nav a:hover {
  opacity: 0.8;
}
.nx-actions {
  display: flex;
  align-items: center;
}
.theme-toggle {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 5px;
  margin-right: 10px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.theme-toggle:hover {
  background-color: rgba(0, 0, 0, 0.05);
}
body.dark-theme .theme-toggle:hover,
body[data-mode="dark"] .theme-toggle:hover,
html[data-mode="dark"] .theme-toggle:hover {
  background-color: rgba(255, 255, 255, 0.1);
}
.theme-toggle .sun-icon,
.theme-toggle .moon-icon {
  display: none;
}
.nx-button {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s;
}
.nx-button.primary {
  background-color: var(--nx-primary);
  color: white;
}
.nx-button.primary:hover {
  filter: brightness(1.1);
}
/* Responsive adjustments */
@media (max-width: 768px) {
  .nx-nav {
    display: none;
  }
  .nx-container {
    justify-content: space-between;
  }
}
</style>
<script>
// This script forwards the click event from our theme toggle to Chirpy's theme toggle
document.addEventListener('DOMContentLoaded', () => {
  const topbarThemeToggle = document.getElementById('topbar-theme-toggle');
  const chirpyThemeToggle = document.getElementById('mode-toggle');
  // Function to check if current theme is dark
  function isDarkTheme() {
    // Check for body background color
    const bodyBg = window.getComputedStyle(document.body).backgroundColor;
    const bodyBgVar = getComputedStyle(document.body).getPropertyValue('--main-bg').trim();
    // Convert background color to hex or check variable value
    let isDark = false;
    // If the body has a background color matching #1b1b1e (or similar dark color)
    if (bodyBg) {
      const rgb = bodyBg.match(/\d+/g);
      if (rgb && rgb.length >= 3) {
        // Check if it's a dark color (rough approximation)
        isDark = (parseInt(rgb[0]) + parseInt(rgb[1]) + parseInt(rgb[2])) / 3 < 128;
      }
    }
    // If the CSS variable --main-bg is set to #1b1b1e
    if (bodyBgVar === '#1b1b1e') {
      isDark = true;
    }
    // Additional checks for theme indicators
    isDark = isDark || 
             document.body.classList.contains('dark-theme') || 
             document.body.getAttribute('data-mode') === 'dark' ||
             document.documentElement.getAttribute('data-mode') === 'dark';
    return isDark;
  }
  // Function to update theme icon based on current theme
  function updateThemeIcon() {
    if (!topbarThemeToggle) return;
    const sunIcon = topbarThemeToggle.querySelector('.sun-icon');
    const moonIcon = topbarThemeToggle.querySelector('.moon-icon');
    const dark = isDarkTheme();
    // In dark mode, show sun icon (to switch to light)
    if (dark) {
      sunIcon.style.display = 'block';
      moonIcon.style.display = 'none';
    } 
    // In light mode, show moon icon (to switch to dark)
    else {
      sunIcon.style.display = 'none';
      moonIcon.style.display = 'block';
    }
  }
  // Set up click event
  if (topbarThemeToggle && chirpyThemeToggle) {
    topbarThemeToggle.addEventListener('click', () => {
      // Trigger a click on Chirpy's theme toggle button
      chirpyThemeToggle.click();
      // Wait a moment for the theme to change, then update icon
      setTimeout(updateThemeIcon, 100);
    });
  }
  // Set icon state on initial load
  updateThemeIcon();
  // Watch for theme changes on body element
  const observer = new MutationObserver((mutations) => {
    mutations.forEach(() => {
      updateThemeIcon();
    });
  });
  observer.observe(document.body, {
    attributes: true,
    attributeFilter: ['class', 'data-mode', 'style']
  });
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-mode', 'class']
  });
  // Check periodically as well
  setInterval(updateThemeIcon, 1000);
});
</script>
<aside aria-label="Sidebar" id="sidebar" class="d-none flex-column align-items-end">
<header class="profile-wrapper">
    <a class="site-title d-block" href="/">Travis Pooley</a>
 </header>
 <nav class="flex-column flex-grow-1 w-100 ps-0">
   <ul class="nav">
     <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
     <li class="nav-item">
        <a href="/#about" class="nav-link">
          <i class="fa-fw fas fa-circle-info"></i>
          <span>About Me</span>
        </a>
     <li class="nav-item">
        <a href="/#experience" class="nav-link">
          <i class="fa-fw fas fa-user-tie"></i>
          <span>Experience</span>
        </a>
     <li class="nav-item">
        <a href="/books/" class="nav-link">
          <i class="fa-fw fas fa-book"></i>
          <span>Books</span>
        </a>
     <li class="nav-item">
        <a href="/blog/" class="nav-link">
          <i class="fa-fw fas fa-newspaper"></i>
          <span>Blog</span>
        </a>
     <li class="nav-item">
        <a href="/#contact" class="nav-link">
          <i class="fa-fw fas fa-envelope"></i>
          <span>Contact</span>
        </a>
   </ul>
 </nav>
 <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>
        <span class="icon-border"></span>
        <a
          href="https://github.com/travispooley"
          aria-label="github"
            target="_blank"
            rel="noopener noreferrer"
        >
          <i class="fab fa-github"></i>
        </a>
        <a
          href="https://twitter.com/travispooley"
          aria-label="twitter"
            target="_blank"
            rel="noopener noreferrer"
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
        <a
          href="javascript:location.href = 'mailto:' + ['travispooley','gmail.com'].join('@')"
          aria-label="email"
        >
          <i class="fas fa-envelope"></i>
        </a>
        <a
          href="/feed.xml"
          aria-label="rss"
        >
          <i class="fas fa-rss"></i>
        </a>
 </div>
</aside>
   <div id="main-wrapper" class="d-flex justify-content-center">
     <div class="container d-flex flex-column px-xxl-5">
<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
 <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
   <nav id="breadcrumb" aria-label="Breadcrumb"><span>
              <a href="/">Home</a>
            </span><span><a href="/blog/">
                  Blog
                </a></span><span>Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus</span></nav>
    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>
   <div id="topbar-title">Post</div>
    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>
    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
 </div>
</header>
       <div class="row flex-grow-1">
         <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
<article class="px-1" data-toc="true">
<header>
   <h1 data-toc-skip>Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus</h1><p class="post-desc fw-light mb-4">Exploring how I built a Prometheus exporter to track live attendance at my local gym. From data scraping to trend analysis, here’s how I turned raw numbers into actionable insights.</p><div class="post-meta text-muted">
      <span>
        Posted
<time
  data-ts="1743733800"
  data-df="ll"
    data-bs-toggle="tooltip" data-bs-placement="bottom"
>
  Apr  4, 2025
</time>
</span>
     <div class="mt-3 mb-3">
          <a href="/assets/images/gym/gym_dashboard_darkmode.webp" class="popup img-link preview-img shimmer"><img src="/assets/images/gym/gym_dashboard_darkmode.webp"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div><div class="d-flex justify-content-between">
        <span>By
          <em><a href="https://twitter.com/travispooley">Travis Pooley</a></em>
        </span>
       <div>
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3374 words"
>
  <em>18 min</em> read</span>
</div>
     </div>
   </div>
 </header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
   </div>
    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>
    <dialog id="toc-popup" class="p-0">
     <div class="header d-flex flex-row align-items-center justify-content-between">
       <div class="label text-truncate py-2 ms-4">Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
     </div>
     <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog><div class="content">
   <h2 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>If you’re anything like me, you tend to be a bit curious about how things work behind the scenes. Maybe it’s a slight hacker tendency or just a habit of not taking data at face value. So when I saw the digital attendance counters on the <em>REDACTED</em> Fitness application, I couldn’t help but wonder how accurate they really were.</p>
<p>I built a Prometheus exporter that scrapes attendance data from all <em>REDACTED</em> Fitness locations. What started as a simple attempt to verify if the counters ever hit zero quickly transformed into a comprehensive data gathering initiative. The project now lives on my home server, integrated with my existing homelab infrastructure, collecting valuable insights about gym attendance patterns across different locations.</p>
<p>In this post, I’ll walk you through how this project came to be, what I discovered, and how you might benefit from similar data about your own gym.</p>
<h2 id="the-problem--hypothesis"><span class="me-2">The Problem &amp; Hypothesis</span><a href="#the-problem--hypothesis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>My scepticism began with a simple observation, people were being counted when entering the gym, but what about when they left? I suspected various scenarios, such as tailgating (when multiple people exit but only one scan occurs) might be causing inaccuracies in the reported numbers.</p>
<p>My primary hypothesis was straightforward, if the counting system was accurate, we should see the numbers hit zero at some point, likely during overnight hours when the gym is empty. If the numbers never reached zero, it would suggest a cumulative error in the system.</p>
<p>This might seem trivial, but accurate attendance data is valuable for both gym-goers (who want to avoid crowds) and gym operators (who need to understand usage patterns for staffing and expansion decisions).</p>
<h2 id="finding-the-data"><span class="me-2">Finding the Data</span><a href="#finding-the-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Whilst the website lists the live tracker functionality all over it, all the links direct you to download the app. This is fair, this gym is unlike most traditional gyms with lock-in contracts and franchises. <em>REDACTED</em> instead has their app that they strongly advertise, and no doubt a lot of the company’s valuation would be based around the application they have to track all aspects of their members. This left me to try and reverse engineer how to find the count.</p>
<p>Based on the page HTML structure, it was evident that the <em>REDACTED</em> website is made in WordPress, so I started to look in all of the usual places. I found the sitemap, but after looking through it, there were no links to the live counter.</p>
<p>My investigative instincts kicked in. I then looked at other common locations where hidden resources might be lurking. Maybe if they were hiding it from the sitemap, they’d have it in the robots.txt file to prevent scrapers from finding it. No luck there either.</p>
<p>Before I went full nuclear and started brute-forcing likely URLs with a tool like GObuster, I had an idea. Just because the URL wasn’t listed in the current sitemap didn’t mean it hadn’t always been there. I wrote a <a href="https://gist.github.com/TravisPooley/820acb25b06811feba9f49982151a590">quick and dirty script</a> to search through public archives from the Wayback Machine, specifically looking for any sites with the string “live” in the URL.</p>
<p>Thankfully this script yielded two results. Even better, one of them happened to be exactly the page I was looking for. When I accessed the page, I was pleasantly surprised. The returned HTML was quite nice well-structured and formatted in a way that made scraping straightforward, such as <code class="language-plaintext highlighter-rouge">&lt;span data-live-count="Elliot" class=" relative text-4xl text-black font-bold"&gt;64&lt;/span&gt;</code>.</p>
<h2 id="page-strucutre"><span class="me-2">Page Strucutre</span><a href="#page-strucutre" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Each gym’s live count is represented by a <code class="language-plaintext highlighter-rouge">span</code> element. The <code class="language-plaintext highlighter-rouge">data-live-count</code> attribute contains the name of the gym (e.g., <code class="language-plaintext highlighter-rouge">"Elliot"</code>), and the actual count is stored as the inner text of that element (e.g., <code class="language-plaintext highlighter-rouge">64</code>).</p>
<p>The live counter website includes a dropdown to choose your gym, but thankfully it has all of the gym counts included in the HTML (the elements are just hidden until you choose that gym). Using this structure, I could use BeautifulSoup (BS4) to scrape one page and create a dictionary with all of the counts. This discovery meant I didn’t need to send multiple complex requests or implement intricate scraping logic. The data was right there, just waiting to be extracted.</p>
<p>There are a few quirks in how the counts are shown. Most notably, when a gym has zero occupants the span doesn’t display a <code class="language-plaintext highlighter-rouge">0</code>. Instead, it appears completely blank. This may be a deliberate decision to avoid displaying potentially misleading or negative numbers. For example, if the entry and exit systems become unsynchronised due to tailgating as discussed previously, the displayed count might drift below zero. Hiding the count when it falls below one could be a simple workaround to prevent this from being shown publicly.</p>
<h2 id="technical-implementation"><span class="me-2">Technical Implementation</span><a href="#technical-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Building the exporter was relatively straightforward. I created a Python script that:</p>
<ol>
 <li>Makes requests to the <em>REDACTED</em> Fitness website at regular intervals
 <li>Parses the HTML to extract the current attendance numbers for each location
 <li>Transforms this data into Prometheus metrics
 <li>Exposes these metrics via an HTTP endpoint that Prometheus can scrape
</ol>
<p>For the backend infrastructure, I leveraged my existing Prometheus and Grafana setup. Prometheus handles the data collection and storage, while Grafana provides visualization capabilities with customisable dashboards. This allowed me to add the gym metrics alongside my existing homelab monitoring with minimal additional configuration.</p>
<h2 id="project-evolution"><span class="me-2">Project Evolution</span><a href="#project-evolution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>When February rolled around, the project took on new significance. The annual influx of “New Year’s resolution warriors” provided a natural experiment in gym attendance patterns. I watched with interest as the numbers swelled in early January, peaked in mid-January, and then gradually declined through February.</p>
<p>This phenomenon transformed my project from a simple verification tool into a longitudinal study. I began tracking retention rates, comparing month on moth data, and monitoring how different locations handled the seasonal surge.</p>
<p>But I ran into a snag I didn’t catch until it was too late. My Prometheus container was set up with a short data retention window, because originally it was just logging short-term metrics like Minecraft server performance or CPU usage. In the Docker config for prometheus-docker, I had the retention set like this:</p>
<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="na">Retention Time</span><span class="pi">:</span> <span class="s">90d</span>
</pre></table></code></div></div>
<p>That meant any data older than 90 days was automatically wiped. I didn’t realise what was happening, and by the time I caught it (about two months later) I’d already lost all the January and February data. That included the entire New Year’s resolution spike, which was the whole point of tracking it in the first place.</p>
<p>I’ve sorted it now. I bumped the retention up to 10 years:</p>
<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="na">Retention Time</span><span class="pi">:</span> <span class="s">10y</span>
</pre></table></code></div></div>
<p>I’ve got the disk space for it, so may as well keep the data. Now everything gets logged long-term, and I won’t get caught out again when I actually want to compare things across years.</p>
<h2 id="practical-applications"><span class="me-2">Practical Applications</span><a href="#practical-applications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Beyond satisfying my curiosity, this project has delivered tangible benefits:</p>
<p>For me personally, I can now identify the optimal times to visit each <em>REDACTED</em> location. For example, I discovered that my local gym is consistently far busier on Mondays than any other day of the week and as such I now have that as a permanent rest day in my routine. Tuesdays, are also quite busy so I usually aim to do legs on Tuesday as the leg machines are often less in demand than other machines.</p>
<p>The location-specific insights are particularly valuable. Each gym has unique patterns based on its location, demographics, and facilities. The CBD locations show clear business-hour patterns, while suburban locations have more consistent attendance throughout the day with peaks after work hours.</p>
<p>I’ve even begun to recognise patterns related to weather, attendance drops significantly during extremely hot days and spikes when outdoor exercise would be uncomfortable.</p>
<p>These insights help me plan my workouts efficiently, avoiding peak times when equipment availability might be limited.</p>
<h2 id="findings--insights"><span class="me-2">Findings &amp; Insights</span><a href="#findings--insights" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>The first major revelation? My hypothesis was correct-the numbers never hit zero, even during the middle of the night when the gym was certainly empty. This confirmed my suspicion about counting inaccuracies.</p>
<p>But the data revealed much more interesting patterns beyond this initial finding:</p>
<ul>
 <li>Each location has distinct “personality traits” in terms of attendance patterns
 <li>Monday evenings are consistently the busiest across all locations
 <li>Saturday afternoons are surprisingly quiet at most locations
 <li>There’s a noticeable drop in attendance during public holidays
 <li>Some locations see sharp spikes during lunch hours on weekdays, while others have a more gradual distribution
 <li>Gyms tend to be busiest at the start of the week, especially on Mondays, and gradually taper off as the week progresses
</ul>
<p>This downward trend is one of the clearest patterns across nearly every location. Mondays often flirt with each gym’s all-time highs, while by Thursday or Friday things are much quieter. You can see this clearly in the screenshot below, but it’s even more apparent in the second example in this section, where the view is narrowed to a single month. With the shorter timeframe, the weekly rhythm stands out much more clearly.</p>
<p><a href="/assets/images/gym/trends_lightmode.webp" class="popup img-link light rounded-10 shimmer"><img src="/assets/images/gym/trends_lightmode.webp" alt="light mode only"  loading="lazy"></a>
<a href="/assets/images/gym/trends_darkmode.webp" class="popup img-link dark rounded-10 shimmer"><img src="/assets/images/gym/trends_darkmode.webp" alt="dark mode only"  loading="lazy"></a>
<em>Week-on-week gym attendance trends over a three-month period. The steady drop-off from Monday through to the weekend.</em></p>
<h2 id="detecting-and-diagnosing-anomalies"><span class="me-2">Detecting and Diagnosing Anomalies</span><a href="#detecting-and-diagnosing-anomalies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>The data also serves as an effective monitoring system for identifying operational issues. By calculating the rate of change (derivative) of attendance numbers across locations, as well as comparing week-on-week trends and differences between locations, anomalies become immediately apparent. Over the past few months, I’ve observed distinct categories of anomalies in the data:</p>
<h3 id="1-the-overrun"><span class="me-2">1. The Overrun</span><a href="#1-the-overrun" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>An overrun happens when the live count at a gym suddenly spikes well beyond what would normally be possible. This type of error has surprisingly occurred a few times.</p>
<p>The most notable example was on the 2nd of March, when all locations outside of Western Australia began counting up rapidly and eventually exceeded their all-time highs by a significant margin. Then, at around 12:30 PM local time, every gym abruptly snapped back to a more typical number.</p>
<p>This kind of behaviour suggests something went wrong in the counting backend. The sharp reset back to expected values makes it likely the issue was identified and corrected mid-day.</p>
<p>You can also see a more subtle example of this in the same dataset on the 7th of March, where there’s a short-lived but noticeable spike. These events aren’t isolated either, the same extreme overrun pattern happened again on the 2nd of July 2025, where many locations reported multiple times their usual counts around 6 PM. Since this occurred during peak gym hours, the inflated values appeared much more dramatic than the earlier midday examples, making the anomaly far more obvious in the data.</p>
<p><a href="/assets/images/gym/overrun_lightmode.webp" class="popup img-link light rounded-10 shimmer"><img src="/assets/images/gym/overrun_lightmode.webp" alt="light mode only"  loading="lazy"></a>
<a href="/assets/images/gym/overrun_darkmode.webp" class="popup img-link dark rounded-10 shimmer"><img src="/assets/images/gym/overrun_darkmode.webp" alt="dark mode only"  loading="lazy"></a>
<em>All locations outside of Western Australia over runnning by up to multiple times their previous highest, before sharp correction</em></p>
<h3 id="2-when-the-data-goes-dark"><span class="me-2">2. When the Data Goes Dark</span><a href="#2-when-the-data-goes-dark" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>The second type of anomaly is when check-ins stop entirely. While it’s normal to see no new entries around 4 AM, seeing this happen during the middle of the day without explanation is a strong signal that something has gone wrong. If a location usually has a steady pattern of activity and that suddenly stops, it often points to a scanner failure.</p>
<p>Short interruptions can sometimes be caused by technical glitches, but longer periods with no data are more commonly due to temporary closures. Still, if the downtime happens during peak hours and with no notice, it’s always worth investigating.</p>
<p>In the example below, one location’s count stopped updating altogether and remained blank for an extended period. It stood out clearly in the data. A quick search of the gym revealed an official announcement confirming the reason:</p>
<blockquote>
 <p>We are so excited to announce that <em>REDACTED</em> Fitness Cranbourne is getting a makeover!</p>
 <p>To get to work, our Cranbourne gym will be closed from 8:00am Monday 28/04/2025 and we will reopen at 7:00am Friday 20/06/2025.</p>
</blockquote>
<p>This kind of planned closure is rare but detectable. The key sign is a complete lack of check-in activity over many days.</p>
<p><a href="/assets/images/gym/Cranbourne_data_light.webp" class="popup img-link light rounded-10 shimmer"><img src="/assets/images/gym/Cranbourne_data_light.webp" alt="light mode only"  loading="lazy"></a>
<a href="/assets/images/gym/Cranbourne_data_dark.webp" class="popup img-link dark rounded-10 shimmer"><img src="/assets/images/gym/Cranbourne_data_dark.webp" alt="dark mode only"  loading="lazy"></a></p>
<h3 id="3-anomalous-lows"><span class="me-2">3. Anomalous Lows</span><a href="#3-anomalous-lows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>These types of errors are typically caused by on-site issues at a specific location. In most cases, it’s due to a malfunctioning scanner. From what I’ve seen, this isn’t always a complete failure. Sometimes the scanner is still technically working, but only picks up one in every 20 check-in attempts.</p>
<p>When that happens, most gym goers won’t hang around and brute force the scanner with check-in attempts. They’ll either tailgate someone else through the gate or use an alternative entry method if available. As a result, the official check-in count ends up being much lower than it should be.</p>
<p>You can spot these anomalies by comparing that gym’s attendance trend against others. Since most <em>REDACTED</em> locations follow fairly consistent patterns throughout the day, a significant drop at one site stands out quickly. Another good way to detect it is by comparing week-on-week attendance. If a location suddenly shows far fewer entries on a day that normally sees heavy traffic, there’s a good chance something’s broken.</p>
<p><a href="/assets/images/gym/Parafield_Example_Light.webp" class="popup img-link light left rounded-10 shimmer"><img src="/assets/images/gym/Parafield_Example_Light.webp" alt="light mode only"  loading="lazy"></a>
<a href="/assets/images/gym/Parafield_Example_Dark.webp" class="popup img-link dark left rounded-10 shimmer"><img src="/assets/images/gym/Parafield_Example_Dark.webp" alt="dark mode only"  loading="lazy"></a>
<em>Example data from the Parafield location showing anomalously low attendance on the 20th and 30th of March</em></p>
<h3 id="4-non-erroneous-anomalies"><span class="me-2">4. Non-erroneous Anomalies</span><a href="#4-non-erroneous-anomalies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Not all anomalies indicate something is broken. Sometimes, they reveal useful patterns hiding in plain sight. One of the most obvious examples is opening day for a new gym. These days almost always show the highest rate of change ever recorded for that location.</p>
<p>It makes sense, there’s a buzz, people are curious, and there’s often a launch event drawing a crowd. The result is a sharp and sudden surge in check-ins, far beyond what you’d expect on a normal day.</p>
<p>Unlike scanner faults or data outages, these spikes aren’t errors. But they stand out clearly when visualised alongside more typical daily trends, and they’re a great example of how rate-of-change metrics can surface significant real-world events.</p>
<p><a href="/assets/images/gym/Australind_launch_lightmode.webp" class="popup img-link light rounded-10 shimmer"><img src="/assets/images/gym/Australind_launch_lightmode.webp" alt="light mode only"  loading="lazy"></a>
<a href="/assets/images/gym/Australind_launch_darkmode.webp" class="popup img-link dark rounded-10 shimmer"><img src="/assets/images/gym/Australind_launch_darkmode.webp" alt="dark mode only"  loading="lazy"></a></p>
<h2 id="technical-details--open-source"><span class="me-2">Technical Details &amp; Open Source</span><a href="#technical-details--open-source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>The entire project is available on GitHub:
<a href="github.com/TravisPooley/RevoFitness-Attendance-Exporter">github.com/TravisPooley/RevoFitness-Attendance-Exporter</a></p>
<p>The core components include:</p>
<ul>
 <li>A Python-based Prometheus exporter using BeautifulSoup for HTML parsing
 <li>Docker configuration for easy deployment
 <li>Grafana dashboard templates for immediate visualization
</ul>
<p>Installation is straightforward for anyone familiar with Docker and Prometheus. The repository includes detailed documentation on getting started, configuring the scraper for different gym chains (the code is adaptable beyond just <em>REDACTED</em>), and setting up alerting for specific thresholds.</p>
<p>I’ve designed the system to be lightweight, consuming minimal resources on even the most modest homelab setups. The entire stack can run comfortably on a Raspberry Pi or any small server.</p>
<h3 id="technical-implementation-deep-dive"><span class="me-2">Technical Implementation Deep Dive</span><a href="#technical-implementation-deep-dive" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Building the exporter required solving several technical challenges: reliable data extraction, proper Prometheus integration and robust error handling. Let me walk you through the key components that make this system work.</p>
<h3 id="the-core-scraping-logic"><span class="me-2">The Core Scraping Logic</span><a href="#the-core-scraping-logic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>The heart of the system is a Python-based collector that implements Prometheus’s custom collector interface. Rather than pre-collecting data at regular intervals, this approach scrapes fresh data every time Prometheus requests metrics, ensuring we never serve stale data.</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">RevoFitnessGymCollector</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Collector to scrape Revo Fitness gym counts at scrape time.</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">target_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">target_url</span> <span class="o">=</span> <span class="n">target_url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="c1"># Metrics for monitoring the scraper itself
</span>        <span class="n">self</span><span class="p">.</span><span class="n">scrape_errors</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">revo_fitness_scrape_errors_total</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Total number of scraping errors</span><span class="sh">'</span><span class="p">,</span>
            <span class="p">[</span><span class="sh">'</span><span class="s">error_type</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">scrape_success</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">revo_fitness_scrape_success_total</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Total number of successful scrapes</span><span class="sh">'</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">scrape_duration</span> <span class="o">=</span> <span class="nc">Histogram</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">revo_fitness_scrape_duration_seconds</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Time spent scraping the Revo Fitness website</span><span class="sh">'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Dynamically collect metrics on each Prometheus scrape.</span><span class="sh">"""</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="nc">GaugeMetricFamily</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">revo_fitness_gym_count</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Live gym occupancy count</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">gym_name</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">scrape_duration</span><span class="p">.</span><span class="nf">time</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">target_url</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Prometheus-Exporter-RevoFitness/1.0</span><span class="sh">'</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>
                <span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">'</span><span class="s">html.parser</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">count_data</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># Extract gym counts from span elements
</span>                <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">span</span><span class="sh">'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">data-live-count</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}):</span>
                    <span class="n">gym_name</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="sh">'</span><span class="s">data-live-count</span><span class="sh">'</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">span</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
                    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Invalid data marker
</span>                    <span class="n">count_data</span><span class="p">[</span><span class="n">gym_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

                <span class="c1"># Add metrics for each gym
</span>                <span class="k">for</span> <span class="n">gym_name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">count_data</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                    <span class="n">metric</span><span class="p">.</span><span class="nf">add_metric</span><span class="p">([</span><span class="n">gym_name</span><span class="p">],</span> <span class="n">count</span><span class="p">)</span>

                <span class="n">self</span><span class="p">.</span><span class="n">scrape_success</span><span class="p">.</span><span class="nf">inc</span><span class="p">()</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Successfully scraped </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">count_data</span><span class="p">)</span><span class="si">}</span><span class="s"> gyms.</span><span class="sh">"</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">scrape_errors</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span><span class="n">error_type</span><span class="o">=</span><span class="nf">type</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="n">__name__</span><span class="p">).</span><span class="nf">inc</span><span class="p">()</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Request error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">scrape_errors</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span><span class="n">error_type</span><span class="o">=</span><span class="nf">type</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="n">__name__</span><span class="p">).</span><span class="nf">inc</span><span class="p">()</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">metric</span>
</pre></table></code></div></div>
<p>The key insight here is using BeautifulSoup to parse the HTML and extract data from elements with the <code class="language-plaintext highlighter-rouge">data-live-count</code> attribute. This approach is resilient to minor HTML changes and provides clean separation between gym names and their counts.</p>
<h3 id="prometheus-integration"><span class="me-2">Prometheus Integration</span><a href="#prometheus-integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>I tried to build the exporter so it follows Prometheus best practices by implementing a custom collector rather than using static metrics. This ensures that each scrape gets fresh data and that we can monitor the scraper’s own performance:</p>
<ul>
 <li><strong>Scrape duration</strong>: Tracks how long each scrape takes
 <li><strong>Success/error counters</strong>: Monitor scraping reliability
 <li><strong>Error type labels</strong>: categorise different failure modes
</ul>
<p>The main application loop is intentionally simple:</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Revo Fitness Gym Count Prometheus Exporter</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--port</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Port to serve metrics on</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--timeout</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">HTTP request timeout in seconds</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--log-level</span><span class="sh">'</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">DEBUG</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">INFO</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">WARNING</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ERROR</span><span class="sh">'</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="sh">'</span><span class="s">INFO</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="n">target_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://revofitness.com.au/livemembercount/</span><span class="sh">"</span>
    <span class="n">collector</span> <span class="o">=</span> <span class="nc">RevoFitnessGymCollector</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">REGISTRY</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">collector</span><span class="p">)</span>

    <span class="nf">start_http_server</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Exporter running on port </span><span class="si">{</span><span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Exporter stopped.</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div>
<h3 id="containerisation-for-reliability"><span class="me-2">Containerisation for Reliability</span><a href="#containerisation-for-reliability" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>To ensure the exporter runs consistently across different environments, I’ve containerised it using Docker. The Dockerfile is deliberately minimal:</p>
<div class="language-dockerfile highlighter-rouge"><div class="code-header">
        <span data-label-text="Dockerfile"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.13-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> revo_fitness_exporter.py .</span>

<span class="k">EXPOSE</span><span class="s"> 8920</span>

<span class="k">CMD</span><span class="s"> ["python", "revo_fitness_exporter.py", "--port", "8920", "--timeout", "50"]</span>
</pre></table></code></div></div>
<p>This approach provides several benefits:</p>
<ul>
 <li><strong>Consistency</strong>: The same environment regardless of host system
 <li><strong>Isolation</strong>: Dependencies don’t conflict with other applications
 <li><strong>Easy deployment</strong>: Single command to get everything running
 <li><strong>Resource efficiency</strong>: Python slim image keeps the container small
</ul>
<h3 id="error-handling-and-resilience"><span class="me-2">Error Handling and Resilience</span><a href="#error-handling-and-resilience" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>The scraper includes comprehensive error handling for common failure scenarios:</p>
<p><strong>Network Issues</strong>: Timeouts and connection errors are caught and logged, but don’t crash the exporter. Prometheus will simply get no new data points for that scrape interval.</p>
<p><strong>Parsing Errors</strong>: If the HTML structure changes or contains unexpected data, the scraper gracefully handles it by setting count values to -1, making it easy to identify data quality issues in Grafana.</p>
<p><strong>Rate Limiting</strong>: The user-agent header helps identify the scraper as a monitoring tool rather than a bot, hopefully reducing the likelihood of being blocked.</p>
<h3 id="deployment-configuration"><span class="me-2">Deployment Configuration</span><a href="#deployment-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>In my homelab setup, the exporter runs as a Docker container with these key configurations, the Prometheus configuration is equally straightforward:</p>
<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># prometheus.yml excerpt</span>
<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">revo-fitness'</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">revo-fitness-exporter:8920'</span><span class="pi">]</span>
    <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">5m</span>
    <span class="na">scrape_timeout</span><span class="pi">:</span> <span class="s">30s</span>
</pre></table></code></div></div>
<h3 id="performance-considerations"><span class="me-2">Performance Considerations</span><a href="#performance-considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>The exporter is designed to be lightweight and efficient:</p>
<ul>
 <li><strong>Minimal dependencies</strong>: Only requests, BeautifulSoup, and prometheus_client
 <li><strong>Low memory footprint</strong>: No data caching or complex state management
 <li><strong>Fast scraping</strong>: Typically completes in under 2 seconds
 <li><strong>Configurable timeouts</strong>: Prevents hanging requests from affecting Prometheus
</ul>
<p>The 5-minute scrape interval provides good temporal resolution for attendance patterns while being respectful of <em>REDACTED</em>’s servers. For detecting rapid anomalies like evacuations, this frequency is sufficient since such events typically unfold over several minutes.</p>
<h3 id="data-quality-and-validation"><span class="me-2">Data Quality and Validation</span><a href="#data-quality-and-validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>One crucial aspect of the implementation is data validation. The system handles several edge cases:</p>
<ul>
 <li><strong>Missing gyms</strong>: If a location disappears from the HTML (like during closures), it simply stops reporting metrics
 <li><strong>Invalid counts</strong>: Non-numeric values are converted to -1 for easy identification
 <li><strong>Network failures</strong>: Temporary outages don’t crash the exporter
</ul>
<p>This robust error handling ensures that temporary issues don’t corrupt the historical data or bring down the monitoring system.</p>
<h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>What began as a sceptical investigation into gym counter accuracy has evolved into a fascinating data project. Along the way, I’ve gained valuable insights into gym attendance patterns, honed my data visualisation skills, and created a useful tool for optimising my workout schedule.</p>
<p>If you’re interested in gym attendance patterns or looking to build similar data collection tools, I encourage you to check out the repository, try it yourself. Sometimes, the most interesting projects come from questioning the accuracy of the everyday systems we take for granted. In this case, a simple doubt about gym attendance counters led to a project that continues to provide valuable insights many months later.</p>
 </div>
 <div class="post-tail-wrapper text-muted">
   <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i><a href="/categories/project/">Project</a></div><div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i><a
            href="/tags/grafana/"
            class="post-tag no-text-decoration"
          >Grafana</a><a
            href="/tags/prometheus/"
            class="post-tag no-text-decoration"
          >Prometheus</a><a
            href="/tags/python/"
            class="post-tag no-text-decoration"
          >Python</a></div><div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
     <div class="license-wrapper">This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a> by the author.</div>
<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
      <a href="https://twitter.com/intent/tweet?text=Data-Driven%20Gym:%20Scraping%20and%20Analysing%20Gym%20Attendance%20with%20Prometheus%20-%20Travis%20Pooley&url=https%3A%2F%2Ftravispooley.com%2Fblog%2Fgym%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?title=Data-Driven%20Gym:%20Scraping%20and%20Analysing%20Gym%20Attendance%20with%20Prometheus%20-%20Travis%20Pooley&u=https%3A%2F%2Ftravispooley.com%2Fblog%2Fgym%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
      <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftravispooley.com%2Fblog%2Fgym%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>
</div>
 </div>
</article>
         </main>
         <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
           <div class="access">
 <section id="access-lastmod">
   <h2 class="panel-heading">Recently Updated</h2>
   <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
       <li class="text-truncate lh-lg">
          <a href="/blog/rtsp/">Never Gonna Give Up Testing: Building an RTSP Docker Container for Security Camera Automation</a>
       <li class="text-truncate lh-lg">
          <a href="/blog/gym/">Data-Driven Gym: Scraping and Analysing Gym Attendance with Prometheus</a>
       <li class="text-truncate lh-lg">
          <a href="/blog/steam-bot/">Automated Trading: How 500 Lines of JavaScript Funded My Steam Library</a>
       <li class="text-truncate lh-lg">
          <a href="/blog/twitter/">Automated Luck: How My Twitter Bot Won Contests While I Slept</a>
   </ul>
 </section>
 <section>
   <h2 class="panel-heading">Trending Tags</h2>
   <div class="d-flex flex-wrap mt-3 mb-1 me-3">
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/ffmpeg/">FFMPEG</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/grafana/">Grafana</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">JavaScript</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">Nodejs</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">Prometheus</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/rtsp/">RTSP</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/steam/">Steam</a>
   </div>
 </section>
           </div>
 <div class="toc-border-cover z-3"></div>
 <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
   <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
   <nav id="toc"></nav>
 </section>
         </aside>
       </div>
       <div class="row">
         <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
 <aside id="related-posts" aria-labelledby="related-label">
   <h3 class="mb-4" id="related-label">Further Reading</h3>
   <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
       <article class="col">
          <a href="/blog/twitter/" class="post-preview card h-100">
           <div class="card-body">
<time
  data-ts="1529029800"
  data-df="ll"
>
  Jun 15, 2018
</time>
             <h4 class="pt-0 my-2">Automated Luck: How My Twitter Bot Won Contests While I Slept</h4>
             <div class="text-muted">
               <p>Winning Twitter contests through code - building a bot to win prizes, mastering APIs, and learning Python. Here&#39;s what I gained from a year of algorithmic luck.</p>
             </div>
           </div>
          </a>
       </article>
       <article class="col">
          <a href="/blog/rtsp/" class="post-preview card h-100">
           <div class="card-body">
<time
  data-ts="1743733800"
  data-df="ll"
>
  Apr  4, 2025
</time>
             <h4 class="pt-0 my-2">Never Gonna Give Up Testing: Building an RTSP Docker Container for Security Camera Automation</h4>
             <div class="text-muted">
               <p>RTSP Docker Container Streams Rickrolls for Hassle-Free Security Camera Automation testing</p>
             </div>
           </div>
          </a>
       </article>
       <article class="col">
          <a href="/blog/steam-bot/" class="post-preview card h-100">
           <div class="card-body">
<time
  data-ts="1628951400"
  data-df="ll"
>
  Aug 15, 2021
</time>
             <h4 class="pt-0 my-2">Automated Trading: How 500 Lines of JavaScript Funded My Steam Library</h4>
             <div class="text-muted">
               <p>The story of my automated arbitrage bot that funded every game I’ve purchased for years. Discover how automation powered my Steam collection and how you can too.</p>
             </div>
           </div>
          </a>
       </article>
   </nav>
 </aside>
<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
    <a
      href="/blog/rtsp/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
     <p>Never Gonna Give Up Testing: Building an RTSP Docker Container for Security Camera Automation</p>
    </a>
   <div class="btn btn-outline-primary disabled" aria-label="Newer">
     <p>-</p>
   </div>
</nav>
<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
 <p>©
    <time>2025</time>
      <a href="https://twitter.com/travispooley">Travis Pooley</a>.
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
 </p>
 <p>Using a modifed version of the <a data-bs-toggle="tooltip" data-bs-placement="top" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p>
</footer>
         </div>
       </div>
<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
 <div class="col-11 content">
   <div id="search-hints">
 <section>
   <h2 class="panel-heading">Trending Tags</h2>
   <div class="d-flex flex-wrap mt-3 mb-1 me-3">
        <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/ffmpeg/">FFMPEG</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/grafana/">Grafana</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">JavaScript</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">Nodejs</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/prometheus/">Prometheus</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/rtsp/">RTSP</a>
        <a class="post-tag btn btn-outline-primary" href="/tags/steam/">Steam</a>
   </div>
 </section>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
     </div>
     <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
     </aside>
   </div>
   <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>
     <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
 <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
 </div>
 <div class="toast-body text-center pt-0">
   <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
 </div>
</aside>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: ' <article class="px-1 px-sm-2 px-lg-4 px-xl-0">  <header>     <h2><a href="{url}">{title}</a></h2>    <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}     </div>  </header>  <p>{snippet}</p></article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }
        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>
  
